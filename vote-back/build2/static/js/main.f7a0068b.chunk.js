(this["webpackJsonpvote-react"]=this["webpackJsonpvote-react"]||[]).push([[0],{40:function(e,t,n){},41:function(e,t,n){},69:function(e,t,n){},70:function(e,t,n){},72:function(e,t,n){"use strict";n.r(t);var c=n(1),r=n.n(c),o=n(33),a=n.n(o),i=(n(40),n(41),n(4)),s=n(2),u=n(12),j=n.n(u),l=n(8),d=n(14),b=n(11),O=n.n(b),p=n(10),v=n(0),h=Object(c.createContext)();function x(e){var t=e.children,n=g({url:"/account/current-user"});return Object(v.jsx)(h.Provider,{value:n,children:t})}function f(){return Object(v.jsxs)("div",{children:[Object(v.jsx)("h2",{children:"\u9700\u8981\u767b\u9646"}),Object(v.jsx)(i.Link,{to:"/login",children:"\u767b\u9646"})]})}function m(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=Object(c.useState)(e),n=Object(p.a)(t,2),r=n[0],o=n[1],a=Object(c.useCallback)((function(e){o(e.target.value)}),[]);return{value:r,onChange:a}}function g(e){var t=Object(c.useState)(),n=Object(p.a)(t,2),r=n[0],o=n[1],a=Object(c.useState)(),i=Object(p.a)(a,2),s=i[0],u=i[1],j=Object(c.useState)(!0),d=Object(p.a)(j,2),b=d[0],v=d[1],h=Object(c.useState)(0),x=Object(p.a)(h,2),f=x[0],m=x[1];return Object(c.useEffect)((function(){var t=O.a.CancelToken.source();return O()(Object(l.a)(Object(l.a)({},e),{},{cancelToken:t.token})).then((function(e){0==e.data.code?(o(e.data.result),u(null)):u(e.data.msg),v(!1)})).catch((function(e){u(e.toString()),v(!1)})),function(){return t.cancel()}}),[e.url,f]),{data:r,loading:b,error:s,update:Object(c.useCallback)((function(){v(!0),m((function(e){return e+1}))}),[])}}function k(){return Object(c.useContext)(h)}function y(e){var t;function n(t){var n=k();return n.loading?null:n.error?Object(v.jsx)(f,{}):Object(v.jsx)(e,Object(l.a)(Object(l.a)({},t),{},{userInfo:n}))}return n.displayName="ForceLogin"+(null!==(t=e.displayName)&&void 0!==t?t:e.name),n}function I(){var e=m(),t=m(),n=Object(s.k)(),r=k();function o(){return(o=Object(d.a)(j.a.mark((function c(){var o,a,i;return j.a.wrap((function(c){for(;;)switch(c.prev=c.next){case 0:return o={name:e.value,password:t.value},c.prev=1,c.next=4,O.a.post("/account/login",o);case 4:a=c.sent,r.update(),n.goBack(),c.next=13;break;case 9:c.prev=9,c.t0=c.catch(1),i=a.data,alert(i.msg);case 13:case"end":return c.stop()}}),c,null,[[1,9]])})))).apply(this,arguments)}return Object(c.useEffect)((function(){r.data&&n.goBack()})),Object(v.jsxs)("div",{children:[Object(v.jsx)("div",{children:"\u7528\u6237\u540d\uff1a"}),Object(v.jsx)("input",Object(l.a)({type:"text"},e)),Object(v.jsx)("div",{children:"\u5bc6\u7801\uff1a"}),Object(v.jsx)("input",Object(l.a)({type:"password"},t)),Object(v.jsx)("div",{children:Object(v.jsx)("button",{onClick:function(){return o.apply(this,arguments)},children:"\u767b\u9646"})})]})}function w(){return Object(v.jsxs)("div",{children:[Object(v.jsx)("div",{children:"\u7528\u6237\u540d\uff1a"}),Object(v.jsx)("input",{type:"text"}),Object(v.jsx)("div",{children:"\u5bc6\u7801\uff1a"}),Object(v.jsx)("input",{type:"password"}),Object(v.jsx)("div",{children:"Email"}),Object(v.jsx)("input",{type:"text"}),Object(v.jsx)("div",{children:Object(v.jsx)("button",{children:"\u6ce8\u518c"})})]})}n(69);function C(){return Object(v.jsxs)("div",{children:[Object(v.jsx)("div",{className:"card",children:Object(v.jsxs)(i.Link,{to:"/create-vote",children:[Object(v.jsx)("img",{className:"card-img"}),"\u521b\u5efa\u5355\u9009"]})}),Object(v.jsx)("div",{className:"card",children:Object(v.jsxs)(i.Link,{to:"/create-vote?multiple=1",children:[Object(v.jsx)("img",{className:"card-img"}),"\u521b\u5efa\u591a\u9009"]})})]})}var S=y((function(e){e.userInfo;var t=g({url:"/vote"}),n=t.loading,c=t.data;return t.error,t.update,n?null:Object(v.jsxs)("div",{children:["\u6211\u7684\u6295\u7968",Object(v.jsx)("ul",{children:c.map((function(e){return Object(v.jsxs)("li",{children:[Object(v.jsx)(i.Link,{to:"/view-vote/"+e.voteId,children:e.title}),Object(v.jsxs)("span",{style:{color:"#3269da"},children:["[",e.multiple?"\u591a\u9009":"\u5355\u9009","]"]}),Object(v.jsxs)("span",{style:{color:"#3269da"},children:["[",e.anonymous?"\u533f\u540d":"\u516c\u5f00","]"]})]},e.voteId)}))})]})}));function N(){return Object(v.jsxs)("div",{children:[Object(v.jsx)(s.d,{path:"/main",exact:!0,children:Object(v.jsx)(s.c,{to:"/main/create"})}),Object(v.jsx)(s.d,{path:"/main/create",component:C}),Object(v.jsx)(s.d,{path:"/main/myvotes",component:S}),Object(v.jsxs)("nav",{children:[Object(v.jsx)(i.NavLink,{to:"/main/create",children:"\u65b0\u5efa"})," | ",Object(v.jsx)(i.NavLink,{to:"/main/myvotes",children:"\u6211\u7684"})]})]})}var L=n(19),M=n(18),Y=n.n(M);var D=y((function(e){e.userInfo;var t=Object(L.a)(["",""]),n=Object(p.a)(t,2),r=n[0],o=n[1],a=m(),i=m(),u=m(Object(c.useMemo)((function(){return Y()().add(1,"year").format("YYYY-MM-DDTHH:mm")}),[])),b=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=Object(c.useState)(e),n=Object(p.a)(t,2),r=n[0],o=n[1],a=Object(c.useCallback)((function(e){o(e.target.checked)}),[]);return{checked:r,onChange:a}}(),h=Object(s.k)(),x=function(){var e=Object(s.l)().search;return Object(c.useMemo)((function(){return new URLSearchParams(e)}),[e])}();function f(){return(f=Object(d.a)(j.a.mark((function e(){var t,n,c;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t={title:a.value,desc:i.value,options:r,deadline:u.value,anonymous:b.checked,multiple:"1"===x.get("multiple")},console.log(t),e.prev=2,e.next=6,O.a.post("/vote",t);case 6:n=e.sent,c=n.data.result,console.log(c),h.push("/view-vote/"+c.voteId),e.next=15;break;case 12:throw e.prev=12,e.t0=e.catch(2),e.t0;case 15:case"end":return e.stop()}}),e,null,[[2,12]])})))).apply(this,arguments)}return Object(v.jsxs)("div",{children:[Object(v.jsx)("h1",{children:"\u521b\u5efa\u6295\u7968"}),Object(v.jsx)("div",{children:Object(v.jsx)("input",Object(l.a)({type:"text",placeholder:"\u6295\u7968\u6807\u9898"},a))}),Object(v.jsx)("div",{children:Object(v.jsx)("input",Object(l.a)({type:"text",placeholder:"\u8865\u5145\u63cf\u8ff0(\u9009\u586b)"},i))}),r.map((function(e,t){return Object(v.jsxs)("div",{children:[Object(v.jsx)("input",{type:"text",placeholder:"\u9009\u9879",value:e,onChange:function(e){return function(e,t){o((function(n){n[e]=t}))}(t,e.target.value)}}),Object(v.jsx)("button",{tabIndex:"-1",onClick:function(){return function(e){o((function(t){t.splice(e,1)}))}(t)},children:"-"})]},t)})),Object(v.jsx)("div",{children:Object(v.jsx)("button",{onClick:function(){return o((function(e){e.push("")}))},children:"\u6dfb\u52a0\u9009\u9879"})}),Object(v.jsxs)("div",{children:["\u622a\u6b62\u65e5\u671f:",Object(v.jsx)("input",Object(l.a)({type:"datetime-local"},u))]}),Object(v.jsxs)("div",{children:["\u533f\u540d\u6295\u7968:",Object(v.jsx)("input",Object(l.a)({type:"checkbox"},b))]}),Object(v.jsx)("div",{children:Object(v.jsx)("button",{onClick:function(){return f.apply(this,arguments)},children:"\u521b\u5efa\u6295\u7968"})})]})})),B=(n(70),n(23)),E=n.n(B);var H=y((function(e){var t,n=e.userInfo,r=Object(s.m)().voteId,o=g({url:"/vote/".concat(r)}),a=o.loading,i=o.data,u=(o.error,o.update,Object(c.useState)()),l=Object(p.a)(u,2),b=l[0],h=l[1],x=Object(L.a)([]),f=Object(p.a)(x,2),m=f[0],k=f[1];function y(e){return I.apply(this,arguments)}function I(){return(I=Object(d.a)(j.a.mark((function e(t){var n;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i.vote.anonymous){e.next=6;break}return n=t.optionId,e.next=4,O.a.post("/vote/".concat(r),{optionIds:[n]});case 4:e.next=9;break;case 6:return e.next=8,O.a.post("/vote/".concat(r),{optionIds:m});case 8:k([]);case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function w(e){if(i.vote.anonymous){if(C.some((function(e){return e.userId===n.data.userId})))return;!function(e){var t=e.optionId;m.includes(t)?k((function(e){var n=e.indexOf(t);e.splice(n,1)})):k((function(e){e.push(t)}))}(e)}else y(e)}Object(c.useEffect)((function(){if(!(a||Date.now()>new Date(i.vote.deadline).getTime())){var e="".concat(window.location.protocol.replace("http","ws"),"//").concat(window.location.host,"/realtime-voteinfo/").concat(r);console.log(e);var t=new WebSocket(e);return t.onmessage=function(e){var t=JSON.parse(e.data);console.log("\u4ecewebsocket\u83b7\u53d6\u5230\u7684\u5b9e\u65f6\u6295\u7968\u4fe1\u606f",t),h(t)},function(){return t.close()}}}),[a,r]);var C=null!==(t=null!==b&&void 0!==b?b:null===i||void 0===i?void 0:i.userVotes)&&void 0!==t?t:[],S=Object(c.useMemo)((function(){return E.a.groupBy(C,"optionId")}),[C]),N=Object(c.useMemo)((function(){return E.a.uniqBy(C,"userId").length}),[C]);return a?"Loading...":Object(v.jsxs)("div",{children:[Object(v.jsx)("h2",{children:i.vote.title}),Object(v.jsxs)("span",{style:{color:"#3269da"},children:["[",i.vote.multiple?"\u591a\u9009":"\u5355\u9009","]"]}),Object(v.jsxs)("span",{style:{color:"#3269da"},children:["[",i.vote.anonymous?"\u533f\u540d":"\u516c\u5f00","]"]}),Object(v.jsx)("h3",{children:i.vote.desc}),Object(v.jsx)("ul",{children:i.options.map((function(e){var t=S[e.optionId]||[];return Object(v.jsxs)("li",{onClick:function(){return w(e)},children:[e.content,"[",t.length,"\u7968] [",0==N?0:(t.length/N*100).toFixed(2),"%]",t.some((function(e){return e.userId==n.data.userId}))?"\u2714\ufe0f":"",m.includes(e.optionId)?"\u2714\ufe0f":"",Object(v.jsx)("div",{}),t.map((function(e){return Object(v.jsx)("span",{className:"user-id",children:e.userId},e.userId)}))]},e.optionId)}))}),!!i.vote.anonymous&&!C.some((function(e){return e.userId==n.data.userId}))&&Object(v.jsx)("button",{disabled:!m.length,onClick:y,children:"\u786e\u5b9a\u6295\u7968"}),Object(v.jsxs)("p",{children:["\u6295\u7968\u622a\u6b62: ",Y()(i.vote.deadline).format("YYYY-MM-DD HH:mm")]})]})}));console.log(i);var T=function(){return Object(v.jsx)(x,{children:Object(v.jsx)(s.a,{children:Object(v.jsx)("div",{className:"App",children:Object(v.jsxs)(s.g,{children:[Object(v.jsx)(s.d,{path:"/",exact:!0,children:Object(v.jsx)(s.c,{to:"/main"})}),Object(v.jsx)(s.d,{path:"/main",component:N}),Object(v.jsx)(s.d,{path:"/login",component:I}),Object(v.jsx)(s.d,{path:"/register",component:w}),Object(v.jsx)(s.d,{path:"/view-vote/:voteId",component:H}),Object(v.jsx)(s.d,{path:"/create-vote",component:D})]})})})})};a.a.render(Object(v.jsx)(r.a.StrictMode,{children:Object(v.jsx)(T,{})}),document.getElementById("root"))}},[[72,1,2]]]);
//# sourceMappingURL=main.f7a0068b.chunk.js.map